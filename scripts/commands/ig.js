const axios = require("axios");
const fs = require("fs-extra");
const path = require("path");

module.exports.config = {
  name: "profile",
  version: "1.0.3",
  permission: 0,
  credits: "King_Shourov",
  description: "Show user profile pic and info",
  prefix: true,
  category: "user",
  usages: "",
  cooldowns: 5
};

module.exports.run = async ({ api, event }) => {
  const uid = event.senderID;

  try {
    const info = await api.getUserInfo(uid);
    const name = info[uid]?.name || "ЁЯШ╢ Unknown User";

    const captions = [
      "тЭЭ ржЖржорж┐ рждрзЛржорж╛ржХрзЗ ржнрж╛рж▓рзЛржмрж╛рж╕рждрж╛ржотАж ржХрж┐ржирзНрждрзБ рждрзБржорж┐ рждрзЛ ржмрзБржЭрзЛржирж┐ тЭЮ тАУ ЁЯТФ BOT OWNER рж╕рзМрж░ржн",
      "тЭЭ рж╣ржарж╛рзО ржХрж░рзЗ ржжрзВрж░рзЗ рж╕рж░рзЗ ржпрж╛ржмрзЛ ржПржХржжрж┐ржи, рждржЦржи ржЦрзБржБржЬрзЗ ржкрж╛ржмрзЗтАж тЭЮ тАУ ЁЯТФ BOT OWNER рж╕рзМрж░ржн",
      "тЭЭ ржнрж╛ржЩрж╛ ржоржи ржЖрж░ ржнрж╛ржЩрж╛ ржмрж┐рж╢рзНржмрж╛рж╕ ржХрзЛржирзЛржжрж┐ржи ржЬрзЛрзЬрж╛ рж▓рж╛ржЧрзЗ ржирж╛тАж тЭЮ тАУ ЁЯЦд BOT OWNER рж╕рзМрж░ржн",
      "тЭЭ ржжрзБржГржЦ ржжрж┐рж▓рзЗ ржоржи ржжрж┐рж▓рзЗ ржирж╛ ржирж┐ржЦрзБржБрждржнрж╛ржмрзЗ ржХрж╛ржжрж┐рзЯрзЗ ржмрж▓рзНрж▓рзЗ ржЖрж░ ржХрзЗржжрзЛ ржирж╛ ЁЯШФЁЯШФЁЯШФЁЯШФ тЭЮ тАУ ЁЯТФ BOT OWNER рж╕рзМрж░ржн",
      "тЭЭ Think before you say bad things тАФ ржнрж╛рж▓рзЛржмрзЗрж╕рзЗ ржлрзЗрж▓ржмрзЗ тШ║я╕ПЁЯМ╕ЁЯМ╗ тЭЮ тАУ ЁЯМ║ BOT OWNER рж╕рзМрж░ржн",
      "тЭЭ ржЖржорж╛рж░ ржорждрзЛ ржЦрж╛рж░рж╛ржк ржЫрзЗрж▓рзЗ, ржПржЗ ржкрзГржерж┐ржмрзАрждрзЗ ржЖрж░ ржПржХржЯрж╛ржУ ржирж╛ржЗтАж ЁЯШЕтЭЮ тАУ ЁЯШФ BOT OWNER рж╕рзМрж░ржн",
      "тЭЭ рж╕рзЗ ржмрж▓рзЗржЫрж┐рж▓рзЛ ржХрзЛржирзЛ ржжрж┐ржирзЛ рж╕рзЗрж░рзЗ ржпрж╛ржмрзЗ ржирж╛тАж рждрж╛рж╣рж▓рзЗ ржЪрж▓рзЗ ржЧрзЗржЫрзЗ ржХрзЗржи? тЭЮ тАУ ЁЯТФЁЯеА BOT OWNER рж╕рзМрж░ржн",
      "тЭЭ ржкрзНрж░ржпрж╝рзЛржЬржи ржЫрж╛ржбрж╝рж╛ ржХрзЗржЙ ржЦрзЛржБржЬ ржирзЗрзЯ ржирж╛тАж ржЪрзЗржирж╛ ржорж╛ржирзБрж╖ ржЧрзБрж▓рзЛ ржЕржЪрзЗржирж╛ рж╣ржпрж╝рзЗ ржпрж╛ржпрж╝ рж░рзЛржЬ тЭЮ тАУ ЁЯШЮ BOT OWNER рж╕рзМрж░ржн",
      "тЭЭ рждрзБржорж┐ ржЧрж▓рзНржк рж╣ржпрж╝рзЗржУ ржЧрж▓рзНржк ржирж╛, рждрзБржорж┐ рж╕рждрзНржпрж┐ рж╣ржпрж╝рзЗржУ ржХрж▓рзНржкржирж╛ тЭЮ тАУ ЁЯММ BOT OWNER рж╕рзМрж░ржн",
      "тЭЭ ржкрж░рж┐рж╕рзНржерж┐рждрж┐рж░ ржХрж╛рж░ржгрзЗ ржЪрзБржк рж╣ржпрж╝рзЗ ржЧрзЗржЫрж┐тАж ржирж╛рж╣рж▓рзЗ рж╣рж╛рж╕рж┐ ржЦрзБрж╢рж┐ рждрзЛ ржЖржорж┐ржУ ржХржо ржЫрж┐рж▓рж╛ржо ржирж╛! тЭЮ тАУ ЁЯШКтЭдя╕ПтАНЁЯй╣ BOT OWNER рж╕рзМрж░ржн",
      "тЭЭ рж╣рж╛рж╕рж┐рж░ ржЙрждрзНрждрж░рзЗ рж╣рж╛рж╕рж┐ ржжрзЗржУрзЯрж╛ ржорж╛ржирзБрж╖ ржЧрзБрж▓рзЛ ржЕрж╕ржорзНржнржм рж╕рзБржирзНржжрж░ ЁЯЩВЁЯШК тЭЮ тАУ тЬи BOT OWNER рж╕рзМрж░ржн",
      "тЭЭ ржХрзЛржирзЛ ржПржХ ржорж╛рзЯрж╛ржмрждрзАрж░ ржЬржирзНржп ржЖржЬржУ ржнрж┐рждрж░ржЯрж╛ ржкрзБрзЬрзЗтАж ЁЯдНЁЯк╜ тЭЮ тАУ ЁЯТФ BOT OWNER рж╕рзМрж░ржн",
      "тЭЭ Life Is Beautiful If You DonтАЩt Fall In Love тЭЮ тЩбя╕О _ржЬрзАржмржи рж╕рзБржирзНржжрж░ ржпржжрж┐ ржХрж╛рж░рзЛ ржорж╛рзЯрж╛рзЯ ржирж╛ ржкрзЬрзЛ ЁЯЩВЁЯТФ тАУ ЁЯЦд BOT OWNER рж╕рзМрж░ржн",
      "тЭЭ ржЬрзАржмржиржЯрж╛ рждржЦржиржЗ рж╕рзБржирзНржжрж░ ржЫрж┐рж▓, ржпржЦржи ржнрж╛ржмрждрж╛ржо ржЖржХрж╛рж╢рзЗрж░ ржЪрж╛ржБржжржЯрж╛ рж╢рзБржзрзБ ржЖржорж╛рж░ рж╕рж╛ржерзЗржЗ рж╣рж╛ржБржЯрзЗтАж ЁЯСЙтЭдя╕ПтАНЁЯй╣ЁЯеА тЭЮ тАУ ЁЯМЩ BOT OWNER рж╕рзМрж░ржн",
      "тЭЭ ржнрж╛ржЩрж╛ ржоржи ржЖрж░ ржнрж╛ржЩрж╛ ржмрж┐рж╢рзНржмрж╛рж╕ ржХрзЛржирзЛржжрж┐ржи ржЬрзЛрзЬрж╛ рж▓рж╛ржЧрзЗ ржирж╛... тЭЮ тАУ ЁЯЦд BOT OWNER рж╕рзМрж░ржн",
      "тЭЭ ржЪрзЛржЦрзЗрж░ ржкрж╛ржирж┐ ржХржЦржирзЛ ржХрж╛ржЙржХрзЗ ржжрзЗржЦрж╛ржЗ ржирж╛, рж╢рзБржзрзБ ржмрж╛рж▓рж┐рж╢ ржЬрж╛ржирзЗ тЭЮ тАУ ЁЯШв BOT OWNER рж╕рзМрж░ржн"
    ];

    const caption = captions[Math.floor(Math.random() * captions.length)];

    const imgURL = `https://graph.facebook.com/${uid}/picture?width=720&height=720`;
    const imgPath = path.join(__dirname, "cache", `${uid}.jpg`);

    const response = await axios({
      url: imgURL,
      method: "GET",
      responseType: "stream"
    });

    const writer = fs.createWriteStream(imgPath);
    response.data.pipe(writer);

    writer.on("finish", () => {
      api.sendMessage({
        body: `ЁЯЦд ЁЭС▓ЁЭС░ЁЭС╡ЁЭСо-ЁЭС║ЁЭСпЁЭС╢ЁЭС╝ЁЭС╣ЁЭС╢ЁЭС╜-ЁЭСкЁЭСпЁЭСиЁЭС╗ ЁЭСйЁЭС╢ЁЭС╗:\nтЭЭ ${caption} тЭЮ\n\nЁЯСд Name: ${name}\nЁЯФЧ UID: ${uid}`,
        attachment: fs.createReadStream(imgPath)
      }, event.threadID, () => fs.unlinkSync(imgPath));
    });

  } catch (e) {
    console.error(e);
    api.sendMessage("тЭМ ржкрзНрж░рзЛржлрж╛ржЗрж▓ рж▓рзЛржб ржХрж░рждрзЗ ржмрзНржпрж░рзНржеред", event.threadID);
  }
};
