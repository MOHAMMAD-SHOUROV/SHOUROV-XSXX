const axios = require("axios");
const fs = require("fs-extra");
const path = require("path");

module.exports.config = {
  name: `${global.config.PREFIX}`, // Usually "/"
  version: "1.0.1",
  permission: 0,
  credits: "King_Shourov",
  description: "Send profile picture with Sad caption",
  prefix: true,
  category: "user",
  usages: "",
  cooldowns: 5,
  dependencies: {}
};

module.exports.run = async ({ api, event }) => {
  const uid = event.senderID;
  const name = event.senderName;

  // ЁЯШв Sad captions with "рж╕рзМрж░ржн" and "King_Shourov"
  const captions = [
    "тЭЭ ржЖржорж┐ рждрзЛржорж╛ржХрзЗ ржнрж╛рж▓рзЛржмрж╛рж╕рждрж╛ржотАж ржХрж┐ржирзНрждрзБ рждрзБржорж┐ рждрзЛ ржмрзБржЭрзЛржирж┐ тЭЮ\nтАУ ЁЯеАЁЭРКЁЭРвЁЭРзЁЭРа_ЁЭРТЁЭРбЁЭРиЁЭРоЁЭРлЁЭРиЁЭРп",
    "тЭЭ рж╣ржарж╛рзО ржХрж░рзЗ ржжрзВрж░рзЗ рж╕рж░рзЗ ржпрж╛ржмрзЛ ржПржХржжрж┐ржи, рждржЦржи ржЦрзБржБржЬрзЗ ржкрж╛ржмрзЗтАж тЭЮ\nтАУ ЁЯТФ рж╕рзМрж░ржн",
    "тЭЭ ржнрж╛ржЩрж╛ ржоржи ржЖрж░ ржнрж╛ржЩрж╛ ржмрж┐рж╢рзНржмрж╛рж╕ ржХрзЛржирзЛржжрж┐ржи ржЬрзЛрзЬрж╛ рж▓рж╛ржЧрзЗ ржирж╛тАж тЭЮ\nтАУ ЁЯЦдЁЭРКЁЭРвЁЭРзЁЭРа_ЁЭРТЁЭРбЁЭРиЁЭРоЁЭРлЁЭРиЁЭРп",
    "тЭЭ ржжрзБржГржЦрзЗрж░ ржжрж┐ржирзЗ ржпрж╛рж░ ржкрж╛рж╢рзЗ ржХрж╛ржЙржХрзЗ ржкрж╛ржУрзЯрж╛ ржпрж╛рзЯ ржирж╛, рждрж╛рж░ ржирж╛ржо ржПржХрж╛ тЭЮ\nтАУ ЁЯШЮ рж╕рзМрж░ржн",
    "тЭЭ рждрзЛрж░ рж╣рзЗрж╕рзЗ ржЙржарж╛рж░ ржорж╛ржЭрзЗ ржЖржЬ ржЖржорж╛рж░ ржХрж╛ржирзНржирж╛ ржЦрзБржБржЬрзЗ ржкрж╛ржЗтАж тЭЮ\nтАУ ЁЯеАЁЭРКЁЭРвЁЭРзЁЭРа_ЁЭРТЁЭРбЁЭРиЁЭРоЁЭРлЁЭРиЁЭРп",
    "тЭЭ ржЪрзЛржЦрзЗрж░ ржкрж╛ржирж┐ ржХржЦржирзЛ ржХрж╛ржЙржХрзЗ ржжрзЗржЦрж╛ржЗ ржирж╛, рж╢рзБржзрзБ ржмрж┐ржЫрж╛ржирж╛рж░ ржмрж╛рж▓рж┐рж╢ ржЬрж╛ржирзЗтАж тЭЮ\nтАУ ЁЯШФ рж╕рзМрж░ржн",
    "тЭЭ ржЖржорж╛рж░ ржнрж╛рж▓рзЛржмрж╛рж╕рж╛ ржЫрж┐рж▓рзЛ рж╕рждрзНржптАж ржХрж┐ржирзНрждрзБ рждрзЛрж░ ржЫрж┐рж▓рзЛ рж╕ржорзЯ ржХрж╛ржЯрж╛ржирзЛрж░ ржЬржирзНржп тЭЮ\nтАУ ЁЯТФЁЭРКЁЭРвЁЭРзЁЭРа_ЁЭРТЁЭРбЁЭРиЁЭРоЁЭРлЁЭРиЁЭРп",
    "тЭЭ ржжрзБржГржЦрзЗ ржорж╛ржирзБрж╖ ржЪрзБржкржЪрж╛ржк рж╣рзЯрзЗ ржпрж╛рзЯтАж ржХрж╛рж░ржг ржХрж╛ржирзНржирж╛рж░ ржнрж╛рж╖рж╛ рж╕ржмрж╛ржЗ ржмрзЛржЭрзЗ ржирж╛ тЭЮ\nтАУ ЁЯЦд рж╕рзМрж░ржн",
    "тЭЭ ржнрж╛рж▓рзЛржмрж╛рж╕рж╛ ржорж╛ржирзЗ ржПржХрждрж░ржлрж╛ ржХрж╖рзНржЯ ржирж╛тАж ржХрж┐ржирзНрждрзБ ржЖржорж┐ рж╢рзБржзрзБ ржХрж╖рзНржЯржЗ ржкрзЗрж▓рж╛ржо тЭЮ\nтАУ ЁЯеАЁЭРКЁЭРвЁЭРзЁЭРа_ЁЭРТЁЭРбЁЭРиЁЭРоЁЭРлЁЭРиЁЭРп",
    "тЭЭ ржХрж┐ржЫрзБ ржЕржирзБржнрзВрждрж┐рж░ ржХрзЛржирзЛ ржирж╛ржо рж╣рзЯ ржирж╛тАж рж╢рзБржзрзБ ржмрзЛржЭрж╛ ржпрж╛рзЯ тЭЮ\nтАУ ЁЯШв рж╕рзМрж░ржн",
    "тЭЭ ржЖржорж┐ ржПржЦржирзЛ ржЕржкрзЗржХрзНрж╖рж╛ ржХрж░рж┐тАж ржпржжрж┐ржУ ржЬрж╛ржирж┐, рждрзБржорж┐ ржЖрж░ ржЖрж╕ржмрзЗ ржирж╛ тЭЮ\nтАУ ЁЯТФЁЭРКЁЭРвЁЭРзЁЭРа_ЁЭРТЁЭРбЁЭРиЁЭРоЁЭРлЁЭРиЁЭРп",
    "тЭЭ ржпрж╛ржХрзЗ рждрзБржорж┐ ржЪрзЛржЦрзЗ рж╣рж╛рж░рж╛ржУ, рж╕рзЗ ржХрж┐ржирзНрждрзБ рждрзЛржорж╛ржХрзЗ рж╣рж╛рж░рж╛ржирзЛрж░ ржнрзЯ ржкрж╛рзЯ ржирж╛ тЭЮ\nтАУ ЁЯеА рж╕рзМрж░ржн",
    "тЭЭ ржпрж╛рж░ рж╣рзГржжржпрж╝ ржнрж╛ржЩрзЗ, рж╕рзЗ ржЪрзБржкржЪрж╛ржк ржерж╛ржХрж▓рзЗржУ ржнрж┐рждрж░рзЗ ржнрж┐рждрж░рзЗ ржХрж╛ржБржжрзЗ тЭЮ\nтАУ ЁЯШЮЁЭРКЁЭРвЁЭРзЁЭРа_ЁЭРТЁЭРбЁЭРиЁЭРоЁЭРлЁЭРиЁЭРп",
    "тЭЭ ржЖржорж┐ рждрзЛ рж╢рзБржзрзБ рждрзЛржХрзЗ ржнрж╛рж▓рзЛржмрзЗрж╕рзЗржЫрж┐рж▓рж╛ржотАж ржХрж┐ржирзНрждрзБ рждрзБржЗ рждрзЛ ржнрж╛рж▓рзЛржмрж╛рж╕рж╛ ржмрзЛржЭрзЛрж╕ ржирж╛ тЭЮ\nтАУ ЁЯТФ рж╕рзМрж░ржн",
    "тЭЭ ржХрж╛рж░рзЛ ржЬржирзНржп ржирж┐ржЬрзЗржХрзЗ ржПрждржЯрж╛ржУ ржмржжрж▓рж┐ржУ ржирж╛тАж ржпрзЗ ржирж┐ржЬрзЗржЗ рждрзЛржХрзЗ ржмрзБржЭрзЗ ржирж╛ тЭЮ\nтАУ ЁЯШФЁЭРКЁЭРвЁЭРзЁЭРа_ЁЭРТЁЭРбЁЭРиЁЭРоЁЭРлЁЭРиЁЭРп"
  ];

  const caption = captions[Math.floor(Math.random() * captions.length)];
  const imgURL = `https://graph.facebook.com/${uid}/picture?width=720&height=720`;
  const imgPath = path.join(__dirname, "cache", `${uid}.jpg`);

  try {
    const response = await axios({
      url: imgURL,
      method: "GET",
      responseType: "stream"
    });

    const writer = fs.createWriteStream(imgPath);
    response.data.pipe(writer);

    writer.on("finish", () => {
      api.sendMessage(
        {
          body: `ЁЯЦд ЁЭС║ЁЭТВЁЭТЕ ЁЭС┤ЁЭТРЁЭТОЁЭТЖЁЭТПЁЭТХ:\nтЭЭ ${caption} тЭЮ\n\nЁЯСд ЁЭРНЁЭРЪЁЭРжЁЭРЮ: ${name}\nЁЯФЧ ЁЭРФЁЭРИЁЭРГ: ${uid}`,
          attachment: fs.createReadStream(imgPath)
        },
        event.threadID,
        () => fs.unlinkSync(imgPath)
      );
    });

  } catch (err) {
    console.error(err);
    api.sendMessage("тЭМ ржкрзНрж░рзЛржлрж╛ржЗрж▓ ржкрж┐ржХржЪрж╛рж░ ржЖржирждрзЗ рж╕ржорж╕рзНржпрж╛ рж╣рзЯрзЗржЫрзЗ!", event.threadID);
  }
};